<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Knife::Server by fnichol</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Knife::Server</h1>
          <h2>An Opscode Chef knife plugin to manage Chef Servers</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/fnichol/knife-server/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/fnichol/knife-server/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/fnichol/knife-server" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><a href="http://travis-ci.org/fnichol/knife-server"><img src="https://secure.travis-ci.org/fnichol/knife-server.png?branch=master" alt="Build Status"></a> <a href="https://gemnasium.com/fnichol/knife-server"><img src="https://gemnasium.com/fnichol/knife-server.png" alt="Dependency Status"></a></p>

<p>An Opscode Chef knife plugin to manage Chef Servers. Currently only
bootstrapping new Chef Servers is supported (on Amazon's EC2) but node
data backup and restore is planned.</p>

<h2>
<a name="usage"></a> Usage</h2>

<p>Follow the <a href="#installation">installation</a> instructions, then you are ready
to create your very own Chef Server running Ubuntu on Amazon's EC2 service:</p>

<div class="highlight">
<pre><span class="nv">$ </span>knife server bootstrap ec2 --ssh-user ubuntu <span class="se">\</span>
    --node-name chefapalooza.example.com
</pre>
</div>


<p>See <a href="#subcommands">below</a> for more details.</p>

<h2>
<a name="installation"></a> Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<div class="highlight">
<pre><span class="n">gem</span> <span class="s1">'knife-server'</span>
</pre>
</div>


<p>And then execute:</p>

<div class="highlight">
<pre><span class="nv">$ </span>bundle
</pre>
</div>


<p>Or install it yourself as:</p>

<div class="highlight">
<pre><span class="nv">$ </span>gem install knife-server
</pre>
</div>


<h3>
<a name="installation-knife"></a> knife.rb Setup</h3>

<p>Most options can be passed to the knife subcommands explicitly but this
quickly becomes tiring, repetitive, and error-prone. A better solution is to
add some of the common configuration to your <code>~/.chef/knife.rb</code> or your
projects <code>.chef/knife.rb</code> file like so:</p>

<div class="highlight">
<pre><span class="n">knife</span><span class="o">[</span><span class="ss">:aws_access_key_id</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"MY_KEY"</span>
<span class="n">knife</span><span class="o">[</span><span class="ss">:aws_secret_access_key</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"MY_SECRET"</span>
<span class="n">knife</span><span class="o">[</span><span class="ss">:region</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"us-west-2"</span>
<span class="n">knife</span><span class="o">[</span><span class="ss">:availability_zone</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"us-west-2a"</span>
<span class="n">knife</span><span class="o">[</span><span class="ss">:flavor</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"t1.micro"</span>
</pre>
</div>


<p>Better yet, why not try a more generic <a href="https://github.com/fnichol/chef-bootstrap-repo/blob/master/.chef/knife.rb">knife.rb</a> file
from the <a href="https://github.com/fnichol/chef-bootstrap-repo/">chef-bootstrap-repo</a> project?</p>

<h2>
<a name="subcommands"></a> Subcommands</h2>

<h3>
<a name="knife-server-bootstrap"></a> knife server bootstrap</h3>

<p>These subcommands will install and configure an Open Source Chef Server on
several different clouds/environments. The high level step taken are as
follows:</p>

<ol>
<li>Provision or use a node and install the Chef Server software fronted by
an Apache2 instance handling SSL for the API port (TCP/443) and the
WebUI web application (TCP/444).</li>
<li>Fetch the validation key from the server and install it onto the
workstation issuing the knife subcommand. The validation key will be
installed at the path defined in the knife <code>validation_key</code> variable.
If a key already exists at that path a backup copy will be made in the
same directory.</li>
<li>Create an initial admin client key called <code>root</code> in the root user's account
on the server which can be used for local administration of the Chef
Server.</li>
<li>Create an admin client key with the name defined in the knife
<code>node_name</code> configuration variable and install it onto the workstation
issuing the knife subcommand. The client key will be installed at the
path defined in the knife <code>client_key</code> configuration variable. If a key
already exists at that path a backup copy will be made in the same
directory.</li>
</ol><h4>Common Configuration</h4>

<h5>--node-name NAME (-N)</h5>

<p>The name of your new Chef Server. The hostname of the system will be set to
this value and the self signed SSL certificate will use this value as its CN.
Ideally this will correspond to the A or CNAME DNS record.</p>

<p>This option is <strong>required</strong>.</p>

<h5>--platform PLATFORM (-P)</h5>

<p>The platform type that will be bootstrapped. By convention a bootstrap
template of <code>chef-server-#{platform}.erb</code> will be searched for in the
template lookup locations (gems, .chef directory, etc.).</p>

<p>The default value is <code>"debian"</code> which support Debian and Ubuntu platforms.</p>

<h5>--ssh-user USER (-x)</h5>

<p>The SSH username used when bootstrapping the Chef Server node. Note that the
some Amazon Machine Images (AMIs) such as the official Canonical Ubuntu images
use non-root SSH users (<code>"ubuntu"</code> for Ubuntu AMIs).</p>

<p>The default value is <code>"root"</code>.</p>

<h5>--ssh-port PORT (-p)</h5>

<p>The SSH port used when bootstrapping the Chef Server node.</p>

<p>The default value is <code>"22"</code>.</p>

<h5>--identity-file IDENTITY_FILE (-i)</h5>

<p>The SSH identity file used for authentication.</p>

<h5>--prerelease</h5>

<p>Installs a pre-release Chef gem rather than a stable release version.</p>

<h5>--bootstrap-version VERSION</h5>

<p>The version of Chef to install.</p>

<h5>--template-file TEMPLATE</h5>

<p>The full path to location of template to use.</p>

<h5>--distro DISTRO (-d)</h5>

<p>Bootstraps the Chef Server using a particular bootstrap template.</p>

<p>The default is <code>"chef-server-#{platform}"</code>.</p>

<h5>--webui-password PASSWORD</h5>

<p>The initial password for the WebUI admin account.</p>

<p>The default value is <code>"chefchef"</code>.</p>

<h5>--amqp-password PASSWORD</h5>

<p>The initial password for AMQP.</p>

<p>The default value is <code>"chefchef"</code>.</p>

<h3>
<a name="knife-server-bootstrap-ec2"></a> knife server bootstrap ec2</h3>

<p>Provisions an EC2 instance on the Amazon Web Services (AWS) cloud and sets
up an Open Source Chef Server as described <a href="#knife-server-bootstrap">above</a>.
In addition, the following steps are taken initially:</p>

<ol>
<li>Create and configure an EC2 Security Group called <strong>"infrastructure"</strong> for
the Chef Server instance. TCP ports 22, 443, and 444 are permitted inbound
for SSH, the API endpoint, and the WebUI web application respectively.</li>
<li>An EC2 instance will be provisioned using configuration and/or defaults
present using the <a href="https://github.com/opscode/knife-ec2">knife-ec2</a> plugin.</li>
</ol><h4>Configuration</h4>

<h5>--aws-access-key-id KEY (-A)</h5>

<p>Your AWS access key ID.</p>

<p>This option is <strong>required</strong>.</p>

<h5>--aws-secret-access-key SECRET (-K)</h5>

<p>Your AWS API secret access key.</p>

<p>This option is <strong>required</strong>.</p>

<h5>--region REGION</h5>

<p>The desired AWS region, such as <code>"us-east-1"</code> or <code>"us-west-2"</code>.</p>

<p>The default value is <code>"us-east-1"</code> but is strongly encouraged to be set
explicitly.</p>

<h5>--ssh-key KEY (-S)</h5>

<p>The AWS SSH key id.</p>

<h5>--flavor FLAVOR (-f)</h5>

<p>The flavor of EC2 instance (m1.small, m1.medium, etc).</p>

<p>The default value is <code>"m1.small"</code>.</p>

<h5>--image IMAGE (-I)</h5>

<p>The AMI for the EC2 instance.</p>

<h5>--availability-zone ZONE (-Z)</h5>

<p>The availability zone for the EC2 instance.</p>

<p>The default value is <code>"us-east-1b"</code>.</p>

<h5>--groups X,Y,Z (-G)</h5>

<p>The security groups for this EC2 instance.</p>

<p>The default value is <code>"infrastructure"</code>.</p>

<h5>--tags T=V[,T=V,...] (-T)</h5>

<p>The tags for this EC2 instance.</p>

<p>The resulting set will include:</p>

<ul>
<li><code>"Node=#{config[:chef_node_name]}"</code></li>
<li><code>"Role=chef_server"</code></li>
</ul><h5>--ebs-size SIZE</h5>

<p>The size of the EBS volume in GB, for EBS-backed instances.</p>

<h5>--ebs-no-delete-on-term</h5>

<p>Do not delete EBS volumn on instance termination.</p>

<h2>
<a name="roadmap"></a> Roadmap</h2>

<ul>
<li>Support for other platforms (alternative bootstrap templates)</li>
<li>Support for Rackspace provisioning (use knife-rackspace gem)</li>
<li>Support for standalone server provisioning</li>
<li>knife server backup {nodes,roles,environments,data bags,all}</li>
<li>knife server backup backed by s3 (fog api)</li>
<li>knife server backup backed by local filesystem</li>
<li>knife server restore {nodes,roles,environments,data bags,all}</li>
<li>knife server restore from s3 archive (fog api)</li>
<li>knife server restore from by local filesystem</li>
</ul><h2>
<a name="development"></a> Development</h2>

<ul>
<li>Source hosted at <a href="https://github.com/fnichol/knife-server">GitHub</a>
</li>
<li>Report issues/questions/feature requests on <a href="https://github.com/fnichol/knife-server/issues">GitHub Issues</a>
</li>
</ul><p>Pull requests are very welcome! Make sure your patches are well tested.
Ideally create a topic branch for every separate change you make. For
example:</p>

<ol>
<li>Fork the repo</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Added some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol><h2>
<a name="authors"></a> Authors</h2>

<p>Created and maintained by <a href="https://github.com/fnichol">Fletcher Nichol</a> (<a href="mailto:fnichol@nichol.ca">fnichol@nichol.ca</a>)</p>

<h2>
<a name="license"></a> License</h2>

<p>Apache License, Version 2.0 (see <a href="https://github.com/fnichol/knife-server/blob/master/LICENSE">LICENSE</a>)</p>
        </section>

        <footer>
          Knife::Server is maintained by <a href="https://github.com/fnichol">fnichol</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-29670723-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>